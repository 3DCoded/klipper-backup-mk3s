[gcode_macro G100]
gcode:
  {% set T = params.T|int %}
  # {% set E = params.E|default(0)|float %}
  # {% set F = params.F|default(3000)|float %}
  {% set N = params.N|default(1)|int %}

  {% if N == 0 %}
  # MANUAL_STEPPER STEPPER=3ms{T} ENABLE=0
  # SET_STEPPER_ENABLE STEPPER=3ms{T} ENABLE=0
  SYNC_EXTRUDER_MOTION EXTRUDER=3ms{T} MOTION_QUEUE=""
  {% else %}
  # SET_STEPPER_ENABLE STEPPER=3ms{T} ENABLE=1
  SYNC_EXTRUDER_MOTION EXTRUDER=3ms{T} MOTION_QUEUE=extruder
  # MANUAL_STEPPER STEPPER=3ms{T} ENABLE=1
  # MANUAL_STEPPER STEPPER=3ms{T} ENABLE=1 SET_POSITION=0
  # MANUAL_STEPPER STEPPER=3ms{T} ENABLE=1 MOVE={E} SPEED={F/60} ACCEL=1000
  # MANUAL_STEPPER STEPPER=3ms{T} ENABLE={N}
  {% endif %}