# 3MS Tip Forming Configuration
# by Christopher Mattar (3DCoded)

## ----- DO NOT EDIT ---- ##

# FORM_TIP macro based on this method:
# https://www.3dchameleon.com/forum/your-3d-chameleon-creations/20-second-color-changes-on-k1-max
# This macro is designed to be universal, reliable, and fast.

## Parameters you will likely change:
# COOLING_TUBE_POS
#   This is the distance between the bottom of the heatsink to the tip of your nozzle
# COOLING_TUBE_LENGTH
#   This is the length of the heatsink
# COOLING_SPEED
#   Increase this as far as you can until the filament tips come out warm and pliable
# FINAL_RETRACT
#   This is the distance from the top of the heatsink to the top of your extruder (right above the extruder gears)
[gcode_macro FORM_TIP]
gcode:
  {% set push_distance = params.PUSH_DISTANCE|default(10)|int %}
  {% set push_speed = params.PUSH_SPEED|default(500)|int %}
  
  {% set cooling_tube_pos = params.COOLING_TUBE_POS|default(15)|int %}
  {% set initial_retract_speed = params.INITIAL_RETRACT_SPEED|default(4000)|int %}
  
  {% set cooling_tube_length = params.COOLING_TUBE_LENGTH|default(11)|int %}
  {% set cooling_speed = params.COOLING_SPEED|default(150)|int %}
  
  {% set final_retract = params.FINAL_RETRACT|default(49)|int %}
  {% set final_speed = params.FINAL_SPEED|default(4000)|int %}

  # Setup extruder
  M83
  G92 E0

  # Push out molten filament
  G0 E{push_distance} F{push_speed}

  # Rapid retract to cooling tube
  G0 E-{cooling_tube_pos} F{initial_retract_speed}

  # Slow single cooling move
  G0 E-{cooling_tube_length} F{cooling_speed}

  # Final retraction out of extruder
  G0 E-{final_retract} F{final_speed}





## Form Tip Settings
[gcode_macro FORM_TIP_SETTINGS]
variable_push_distance: 10
variable_push_speed: 500
variable_cooling_tube_pos: 15
variable_initial_retract_speed: 4000
variable_cooling_tube_length: 11
variable_cooling_speed: 150
variable_final_retract: 49
variable_final_speed: 4000
gcode:
    RESPOND MSG="This macro is not meant to be run."
  