[save_variables]
filename: ~/printer_data/config/3ms/variables.cfg

[gcode_macro Toolchange]
gcode:
  {% set p = printer.save_variables.variables.p|int %}
  {% set t = params.T|int %}
  {% if p > -1 %}
  G100 T{p} E-100 F4500 N0
  {% endif %}
  G1001 T{t} E110 F4500 N0
  SAVE_VARIABLE VARIABLE=p VALUE={t}

[gcode_macro T0]
gcode:
  Toolchange T=0

[gcode_macro T1]
gcode:
  Toolchange T=1

[include ./steppers.cfg]
[include ./g100.cfg]
[include ./g101.cfg]
[include ./ks.cfg]
[include ./tmc.cfg]