[gcode_macro M900]
description: Set Pressure Advance
gcode:
  {% set k = params.K|default(0)|float %}
  {% if k < 1 %}
    SET_PRESSURE_ADVANCE ADVANCE={k}
  {% endif %}

[gcode_macro RECURSION_TEST]
gcode:
  {% set num = params.NUM|default(5)|int %}
  {% if num == 0 %}
  RESPOND MSG="End"
  {% else %}
  RESPOND MSG={num}
  RECURSION_TEST NUM={num-1}
  {% endif %}

[gcode_macro SMART_G28]
description: Only home unhomed axes
gcode:
  {% set axes = rawparams|default("xyz") %}
  {% set homed = printer.toolhead.homed_axes %}
  {% set to_home = "" %}
  {% for axis in axes %}
    {% if axis not in homed %}
      {% set to_home = to_home + axis %}
    {% endif %}
  {% endfor %}
  G28 {to_home}